<link rel="stylesheet" href="/css/home.css">

<% if(!locals.user){ %>
    <div class="welcome">
        <h2>Welcome to Home Page &#128525</h2>
        <h3>Kindly sign in to post something exciting &#128515</h3>
    </div>

    <hr>
    <% } %>

        <section id="feed-posts">

            <h3>Posts</h3>

            <% if(locals.user){ %>
                <h4>Post something...</h4>
                <div class="form-outline">
                    <form action="/posts/addPost" id="new-post-form" method="POST">

                        <textarea class="form-area" name="content" cols="30" rows="4" placeholder="Type here.."
                            required></textarea>
                        <button type="submit">Post</button>
                    </form>
                </div>

                <% } %>

                    <hr>

                    <div id="posts-list-container">

                        <ul>
                            <% for (post of posts) {%>
                                <li>
                                    <p>

                                        <% if( locals.user && post.user.id == locals.user.id){%>

                                            <small>
                                                <a href="/posts/destroy/<%= post.id %>">X</a>
                                            </small>
                                        <%}%>
                                        
                                        <small>    
                                            <i>
                                                <%=post.user.name%>
                                            </i>
                                        </small>
                                    </p>
                                    <p>
                                        <%=post.content%>
                                    </p>

                                </li>

                                <div class="post-comments">

                                    <% if(locals.user){ %>
                                        <form action="comments/create" method="POST">

                                            <input type="text" name="content" placeholder="Add your comment" required>
                                            <input type="hidden" name="post" value="<%= post._id%>">
                                            <input type="submit" value="add comment">
                                        </form>
                                        <%}%>

                                            <div class="post-comment-list">
                                                <ul id="post-comments-<%=post._id%>">


                                                    <% for(comment of post.comments){ %>
                                                        <li>
                                                            <p>
                                                                <%if( locals.user && comment.user.id == locals.user.id){%>
                                                                    <small>
                                                                        <a href="/comments/destroy/<%= comment._id %>">X</a>
                                                                    </small>
                                                                <%}%>

                                                                <small>
                                                                    <i>
                                                                        <%= comment.user.name %>
                                                                    </i>
                                                                </small>
                                                                <br>
                                                                <%= comment.content %>
                                                            </p>
                                                        </li>

                                                        <%}%>
                                                </ul>


                                            </div>
                                </div>
                                <hr>
                                <%}%>
                        </ul>
                    </div>
        </section>